# CPU

![CPU](./image/CPU.png)

---
## 구성

***
### ALU

![ALU](./image/ALU.png)
- 레지스터를 통해 피연산자를 받아들인다.
- 제어장치로부터 수행할 연산을 알려주는 제어 신호를 받아들인다.


- 결과값을 레지스터에 저장한다. (메모리에 게속 저장하면 성능 저하됨.)
- 플래그를 내보낸다. (플래그 레지스터에)

#### 플래그
연산 결과에 따른 추가 정보

1. 부호 플래그: 연산결과의 부호 나타냄 (1: 음수, 0: 양수)
2. 제로 플래그: 연산 결과가 0인지 아닌지 나타냄 (1: 0, 0: 0이 아님)
3. 캐리 플래그: 연산 결과 올림수나 빌림수가 발생했는지 나타냄 (1: 발생, 0: 안발생)
4. 오버플로우 플래그: 오버플로우 발생여부 (1: 발생, 0: 안발생)
5. 인터럽트 플래그: 인터럽트 가능한지 나타 (1: 가능, 0: 불가능)
6. 슈퍼바이저 플래그: 커널모드인지 사용자모드인지 나타냄 (1: 커널, 0: 사용자)

***
### 제어장치

![제어장치](./image/제어장치.png)

***
### 레지스터

1. 프로그램 카운터(PC) = 명령어 포인터(IP): 메모리에서 가져올 명령어의 주소, 메모리에서 읽어 들일 명령어의 주소를 저장.
2. 명령어 레지스터(IR): 해석할 명령어, 방금 메모리에서 읽어 들인 명령어 저장
3. 메모리 주소 레지스터(MAR): 메모리의 주소를 저장하는 레지스터
4. 메모리 버퍼 레지스터(MBR) = 메모리 데이터 레지스터(MDR): 메모리와 주고받을 값을 저장하는 레지스터
5. 플래그 레지스터(FR): 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터
6. 범용 레지스터(GPR): 일반적인 상황에서 자유롭게 사용가능, 데이터, 주소 다 저장 가능.
7. 스택 포인터: 메모리의 스택 영역에 가장 최근에 저장된 값의 위치를 저장하는 레지스터.
8. 베이스 레지스터: 주소 지정 방식에서 베이스 레지스터를 이용할 때 사용된다.

#### 스택 주소 지정 방식
- 스택 포인터를 이용
#### 상대 주소 지정 방식
- 프로그램 카운터와 오퍼랜드 값을 더해서 주소를 알아냄
#### 베이스 레지스터 주소 지정 방식
- 베이스 레지스터 값과 오퍼랜드 값을 더해서 주소를 알아냄

***
## 명령어 사이클 (instruction cycle)

프로그램은 여러 명령어로 이루어져 있고, 이 명령어들은 일정한 주기가 반복되며 실행된다.
이 주기를 명령어 사이클 이라고 한다. (하나의 명령어를 처리하는 정형화된 흐름)

1. 인출 사이클(fetch cycle): 명령어를 메모리에서 cpu까지 가지고 오는 단계
2. 실행 사이클(execution cycle): cpu로 가져온 명령어를 실행
3. 간접 사이클(indirect cycle): 간접 주소 지정 방식 같은 경우 메모리 접근이 한번 더 필요하다.

## 인터럽트 (Interrupt)

cpu의 작업을 방해하는 신호

![인터럽트](./image/인터럽트.png)

- 동기 인터럽트(예외): cpu에 의해 발생하는 인터럽트. 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생
- 비동기 인터럽트(하드웨어 인터럽트): 주로 입출력 장치에 의해 발생.

### 하드웨어 인터럽트
명령어를 효율적으로 처리하기 위한 인터럽트

입출력 장치는 cpu보다 느리다. 따라서 입출력 장치의 결과를 받아야 하는 명령어가 실행되었을 때,
cpu는 언제 끝날지도 모르는 입출력 장치가 완료되는 시점까지 아무것도 못한다. 이는 낭비다.
따라서 하드웨어 인터럽트를 사용해서, cpu는 입출력 장치가 일하는 동안 다른 명령어들을 수행하다가,
입출력 장치로 부터 하드웨어 인터럽트가 오면 상황봐서 인터럽트를 받는다.

- 처리순서
1. 입출력 장치가 cpu에 **인터럽트 요청 신호** 보낸다.
2. cpu는 실행 사이클이 끝나고 다음 명령어를 인출하기 전에 인터럽트 여부 확인한다.
3. 인터럽트 요청이 있다면, 인터럽트 플래그 확인해서 현재 인터럽트 받아들일 수 있는 상황인지 본다.
4. 인터럽트 받을 수 있으면 지금까지 작업을 메모리 스택영역에 백업한다.
5. cpu는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴 실행한다.
6. 인터럽트 서비스 루틴 끝나면 백업해둔 작업 복구해서 실행한다.

- 인터럽트 요청 신호: 끼어들어도 되냐고 묻는 신호
- 인터럽트 플래그: 인터럽트를 받을지 말지 결정하는 플래그. 받기싫어도 우선순위가 더 높은 하드웨어 인터럽트 발생하면 하드웨어 인터럽트 부터 처리한다.
- 인터럽트 서비스 루틴 = 인터럽트 핸들러: 인터럽트 처리 위한 프로그램
- 인터럽트 벡터: 인터럽트 서비스 루틴을 구분하기 위한 인터럽트 서비스 루틴을 식별하기 위한 정보
